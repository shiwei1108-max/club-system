<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾åœ˜ç³»çµ± - å®Œæ•´ä¸²æ¥æ¸¬è©¦</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
    .container { max-width: 600px; margin: 0 auto; }
    .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
    input { width: 95%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px;}
    button:hover { background: #1976D2; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    
    .response-box { 
      background: #282c34; color: #61dafb; 
      padding: 15px; border-radius: 5px; 
      font-family: monospace; white-space: pre-wrap; 
      display: none; margin-top: 10px; overflow-x: auto;
    }
  </style>
</head>
<body>
<div class="container">

  <div class="card">
    <h2>1. ç™»å…¥å–å¾— Token</h2>
    <input type="text" id="email" value="student@ncue.edu.tw">
    <input type="password" id="password" value="mypassword">
    <button onclick="doLogin()">ğŸ”‘ ç™»å…¥ (Login)</button>
    <div id="loginResult" class="response-box"></div>
  </div>

  <div class="card">
    <h2>2. å­˜å–å—ä¿è­·çš„è³‡æ–™ (API)</h2>
    <p>é€™è£¡æ¨¡æ“¬ App è¦å»æŠ“ç¤¾åœ˜è³‡æ–™ã€‚å¦‚æœæ²’æœ‰ Tokenï¼Œæœƒè¢«ä¼ºæœå™¨è¸¢å‡ºä¾†ã€‚</p>
    <button id="btnGetData" onclick="getClubData()" disabled>ğŸš« è«‹å…ˆç™»å…¥æ‰èƒ½æŒ‰</button>
    <div id="dataResult" class="response-box"></div>
  </div>

</div>

<script>
  let myToken = ''; // ç”¨ä¾†æš«å­˜ Token çš„è®Šæ•¸

  // --- A. ç™»å…¥å‡½å¼ ---
  async function doLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const resultBox = document.getElementById('loginResult');

    resultBox.style.display = 'block';
    resultBox.innerText = 'â³ é€£ç·šä¸­...';

    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();

      if (data.success) {
        // 1. ç™»å…¥æˆåŠŸï¼ŒæŠŠ Token å­˜èµ·ä¾†
        myToken = data.token; 
        
        // 2. æ›´æ–°ç•«é¢
        resultBox.style.color = '#4caf50'; // ç¶ è‰²
        resultBox.innerText = `âœ… ç™»å…¥æˆåŠŸï¼Token å·²ä¿å­˜ã€‚\n(å‰20ç¢¼: ${myToken.substring(0,20)}...)`;
        
        // 3. è§£é–ä¸‹é¢çš„æŒ‰éˆ•
        const btn = document.getElementById('btnGetData');
        btn.disabled = false;
        btn.innerText = 'ğŸ”“ ç¾åœ¨å¯ä»¥æŠ“å–ç¤¾åœ˜è³‡æ–™äº† (Get Data)';
        btn.style.background = '#4CAF50';
      } else {
        resultBox.style.color = '#ff5252'; // ç´…è‰²
        resultBox.innerText = `âŒ å¤±æ•—: ${data.message}`;
      }
    } catch (err) {
      resultBox.innerText = 'é€£ç·šéŒ¯èª¤: ' + err;
    }
  }

  // --- B. æŠ“å–è³‡æ–™å‡½å¼ (å¸¶è‘— Token å») ---
  async function getClubData() {
    const resultBox = document.getElementById('dataResult');
    resultBox.style.display = 'block';
    resultBox.innerText = 'â³ æ­£åœ¨æ‹¿ç¥¨æ ¹çµ¦è­¦è¡›æª¢æŸ¥...';

    try {
      const res = await fetch('/api/clubs/club-center', {
        method: 'GET',
        headers: {
          // ã€é—œéµï¼ã€‘é€™è£¡å°±æ˜¯æŠŠ Token ç§€çµ¦è­¦è¡›çœ‹çš„åœ°æ–¹
          'Authorization': 'Bearer ' + myToken 
        }
      });

      const data = await res.json();
      
      // æŠŠå›å‚³çš„ JSON ç¾åŒ–é¡¯ç¤ºå‡ºä¾†
      resultBox.style.color = '#61dafb';
      resultBox.innerText = JSON.stringify(data, null, 2); 
      
    } catch (err) {
      resultBox.innerText = 'éŒ¯èª¤: ' + err;
    }
  }
</script>
</body>
</html>